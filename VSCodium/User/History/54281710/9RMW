# Use the official Ubuntu 22.04 as a base image
FROM ubuntu:22.04

# Avoid interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Set build-time arguments for user and group IDs, with a default
ARG USER_ID=1000
ARG GROUP_ID=1000

# Update packages, install sudo, and create a non-root user
RUN apt-get update && apt-get install -y sudo \
    && groupadd --gid $GROUP_ID devuser \
    && useradd --uid $USER_ID --gid $GROUP_ID --create-home --shell /bin/bash devuser \
    # Add the new user to the sudo group and allow passwordless sudo
    && adduser devuser sudo \
    && echo "devuser ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers.d/devuser \
    # Clean up apt cache to keep the image small
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# Set the default user for the container
USER devuser

# Set the default working directory
WORKDIR /home/devuser
